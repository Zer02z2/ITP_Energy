[
    {
        "id": "60f9891f1bbbbdf0",
        "type": "template",
        "z": "7274d2a37cb1887b",
        "name": "web client to acces data",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<html>\n    <head>\n        <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n        <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n        <link href=\"https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap\" rel=\"stylesheet\">\n        <style>\n            .ubuntu-mono-regular {\n                font-family: \"Ubuntu Mono\", monospace;\n                font-weight: 400;\n                font-style: normal;\n                }\n\n            .ubuntu-mono-bold {\n            font-family: \"Ubuntu Mono\", monospace;\n            font-weight: 700;\n            font-style: normal;\n            }\n\n            .ubuntu-mono-regular-italic {\n            font-family: \"Ubuntu Mono\", monospace;\n            font-weight: 400;\n            font-style: italic;\n            }\n\n            .ubuntu-mono-bold-italic {\n            font-family: \"Ubuntu Mono\", monospace;\n            font-weight: 700;\n            font-style: italic;\n            }\n\n            body {\n                font-family: \"Ubuntu Mono\";\n                padding: 3rem;\n                background-color: rgba(230, 230, 230, 1);\n                color: rgba(20, 20, 20, 1);\n            }\n            th, td {\n                padding: 0.5rem 4rem 1rem 0.5rem;\n                text-align: left;\n                vertical-align: baseline;\n            }\n            table {\n                \n            }\n            input {\n                width: 15rem;\n                padding: 1rem;\n                font-family: \"Ubuntu Mono\";\n                border: none;\n                background-color: rgba(250, 250, 250, 1);\n                &:focus {\n                    outline: none;\n                }\n            }\n            button {\n                padding: 0.5rem 1rem;\n                cursor: pointer;\n                font-family: \"Ubuntu Mono\";\n                border: none;\n                background-color: rgba(30, 30, 30, 1);\n                border-radius: 2px;\n                color: rgba(220, 220, 220, 1);\n                font-size: 1em;\n                font-weight: bold;\n            }\n            #previous,#next, #clear {\n                background-color: rgba(0, 0, 0, 0);\n                color: rgba(20, 20, 20, 1);\n                &:hover {\n                    text-decoration: underline;\n                }\n            }\n        </style>\n    </head>\n    <body>\n        <h1>ITP Energy Skylab Database</h1>\n        <br><br>\n        <button id=\"clear\" style=\"padding:0.5rem;text-decoration:underline\">Clear filters</button>\n        <table border=1 frame=void rules=rows>\n            <thead>\n                <tr>\n                    <th scope=\"col\"><button id=\"search\">Search ↻</button></th>\n                    <th scope=\"col\">Topic &emsp;<input class=\"filter\" id=\"topicFilter\" placeholder=\"contains: e.g. light\"></input></th>\n                    <th scope=\"col\">Data &emsp;<input class=\"filter\" id=\"dataFilter\" placeholder=\"contains: e.g. ppm\"></input></th>\n                    <th scope=\"col\">Time &emsp;<input class=\"filter\" id=\"timeFilter\" placeholder=\"contains: e.g. 4/18\"></input>\n                        <button id=\"sort\" style=\"background:none;color:rgba(20,20,20,1);font-weight:normal\">⇅</button></th>\n                </tr>\n            </thead>\n            <tbody id=\"content\"></tbody>\n        </table>\n        <p id=\"feedback\" style=\"font-weight:normal\"></p>\n        <br><br>\n        <table id=\"navi\">\n            <tr>\n                <td><button id=\"previous\">Previous</button></td>\n                <td><p id=\"pageCount\"></p></td>\n                <td><button id=\"next\">Next</button></td>\n            </tr>\n        </table>\n        <script>\n            let page = 0, order = -1;\n            let content = document.getElementById(\"content\");\n            let filters = document.getElementsByClassName(\"filter\");\n            let searchButton = document.getElementById(\"search\");\n            let clearButton = document.getElementById(\"clear\");\n            let sortButton = document.getElementById(\"sort\");\n            let previousButton = document.getElementById(\"previous\");\n            let nextButton = document.getElementById(\"next\");\n            let feedback = document.getElementById(\"feedback\");\n            let pageCount = document.getElementById(\"pageCount\");\n            let endpoint = \"https://io.zongzechen.com/data\";\n\n            search(page); // initial fetch\n\n            searchButton.addEventListener('click', () => { // search button\n                page = 0; // reset search index\n                search(page); \n                content.innerHTML = \"\";\n            });\n\n            clearButton.addEventListener('click', () => { // search button\n                for (const filter of filters) filter.value = \"\";\n                page = 0; // reset search index\n                search(page); \n                content.innerHTML = \"\";\n            });\n\n            sortButton.addEventListener('click', () => { // search button\n                order *= -1;\n                page = 0; // reset search index\n                search(page); \n                content.innerHTML = \"\";\n            });\n\n            previousButton.addEventListener('click', () => { // fetch the last 10 row\n                if (page > 0) {\n                    page --;\n                    search(page);\n                    content.innerHTML = \"\";\n                }\n            });\n\n            nextButton.addEventListener('click', () => { // fetch the next 10 row\n                page ++;\n                search(page);\n                content.innerHTML = \"\";;\n            });\n\n            for (const filter of filters) {\n                filter.addEventListener(\"keypress\", (e) => {\n                    if (e.key === \"Enter\") searchButton.click();\n                })\n            }\n\n            function search(index) {\n                pageCount.innerHTML = `Page ${page + 1}`;\n                let topic = filters[0].value; // get topic query\n                let data = filters[1].value; // get topic query\n                let time = filters[2].value; // get topic query\n                getData(`${endpoint}?topic=${topic}&data=${data}&time=${time}&index=${index}&order=${order}`); // set the url\n            }\n\n            async function getData(url) {\n                feedback.innerHTML = \"Loading...\";\n                let response = await fetch(url); // raw data back\n                let data = await response.json(); // format to json\n                if (data.length == 0) feedback.innerHTML = \"No match or have reached the end\";\n                else feedback.innerHTML = \"\";\n                parseData(data); // send to parse the data\n            }\n\n            function parseData(data) { // the entire table\n                let index = 1;\n                for (const line of data) { // now parse each line of the table\n                    let newRow = document.createElement(\"tr\");\n                    let indexCell = document.createElement(\"td\");\n                    indexCell.innerHTML = index;\n                    newRow.appendChild(indexCell);\n                    index ++;\n                    for (const key in line) {\n                        let newCell = document.createElement(\"td\");\n                        let message = line[key];\n                        newCell.innerHTML = message;\n                        newRow.appendChild(newCell);\n                    }\n                    content.appendChild(newRow);\n                }\n            }\n        </script>\n    </body>\n</html>",
        "x": 710,
        "y": 1120,
        "wires": [
            [
                "1b32b653176d1a99"
            ]
        ]
    }
]